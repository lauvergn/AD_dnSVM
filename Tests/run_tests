#!/bin/bash

./clean

here=`pwd`


#for ExternalF90 in gfortran ifort pgf90 nagfor
for F90 in gfortran
do
  echo xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  echo xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  echo $F90
  echo xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  echo xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  for OPT in 0 1
  do
    for OMP in 0 1
    do

      echo OPT: $OPT OpenMP: $OMP

      cd ..
        XRES="Xres_dnS_dnPoly_"$F90"_Opt"$OPT"_OMP"$OMP
        XLOG="comp_"$F90"_Opt"$OPT"_OMP"$OMP".log"
        make clean > $here/$XLOG 2>&1
        make F90=F90 OPT=OPT OMP=OMP all > $here/$XLOG 2>&1
        make ut > $here/$XRES
      cd  $here
      grep "Number of error" $XRES

    done
  done

done

for XRES in Xres*
do
  RES=`echo $XRES | sed "s/X//"`
  mv $XRES $RES
done
